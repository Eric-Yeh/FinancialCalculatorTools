<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šæ¨¡å¼è²¡å¯ŒçœŸç›¸è¨ˆç®—æ©Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --inv-color: #10b981; /* æŠ•è³‡ç¶  */
            --inf-color: #ef4444; /* é€šè†¨ç´… */
            --real-color: #3b82f6; /* å¯¦è³ªè— */
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-color: #1f2937;
        }

        body {
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            padding: 20px;
            color: var(--text-color);
        }

        .container {
            background-color: var(--card-bg);
            width: 100%;
            max-width: 1200px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            border-radius: 16px;
        }

        h1 {
            text-align: center;
            color: #111;
            margin-bottom: 30px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .top-section {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }

        .panel {
            flex: 1;
            min-width: 320px;
            padding: 25px;
            border-radius: 12px;
            position: relative;
        }

        /* å·¦é‚Šï¼šè³‡ç”¢è¨­å®š */
        .panel-invest {
            background-color: #ecfdf5;
            border: 2px solid #a7f3d0;
        }
        .panel-invest h2 { color: var(--inv-color); margin-top: 0; }

        /* å³é‚Šï¼šé€šè†¨ */
        .panel-inflation {
            background-color: #fef2f2;
            border: 2px solid #fecaca;
        }
        .panel-inflation h2 { color: var(--inf-color); margin-top: 0; }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.95rem; }
        
        .input-group {
            display: flex;
            align-items: center;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        .input-group input, .input-group select {
            flex: 1;
            padding: 10px;
            border: none;
            outline: none;
            font-size: 1.1rem;
            text-align: right;
            background: white;
        }
        .input-group select { text-align: center; cursor: pointer; font-weight: bold; color: #333; }
        .input-group .unit {
            padding: 0 15px;
            background-color: #f9fafb;
            color: #666;
            font-size: 0.9rem;
            border-left: 1px solid #ddd;
            white-space: nowrap;
        }

        /* æ§åˆ¶æ¬„ä½é¡¯ç¤ºéš±è— */
        .hidden { display: none; }

        /* ä¸‹åŠéƒ¨ */
        .bottom-section {
            border-top: 2px dashed #ddd;
            padding-top: 30px;
        }

        .summary-cards {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .card {
            flex: 1;
            min-width: 200px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #eee;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
        }

        .card h3 { margin: 0 0 10px 0; font-size: 0.9rem; color: #666; }
        .card .value { font-size: 1.5rem; font-weight: 800; }
        .card .sub-text { font-size: 0.8rem; margin-top: 5px; color: #888; }

        .val-nominal { color: var(--inv-color); }
        .val-real { color: var(--real-color); }
        .val-loss { color: var(--inf-color); }

        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
            background: white;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #eee;
        }

        .table-wrapper {
            margin-top: 30px;
            max-height: 300px;
            overflow-y: auto;
            border-radius: 8px;
            border: 1px solid #eee;
        }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th { background-color: #f3f4f6; position: sticky; top: 0; padding: 12px; text-align: center; }
        td { padding: 10px; text-align: center; border-bottom: 1px solid #eee; }
        tr:hover { background-color: #f9fafb; }

    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ’¸ è²¡å¯ŒçœŸç›¸è¨ˆç®—æ©Ÿï¼šå¤šæ¨¡å¼è©¦ç®—</h1>
    
    <div class="top-section">
        <div class="panel panel-invest">
            <h2>ğŸ“ˆ è³‡ç”¢ç´¯ç©è¨­å®š</h2>
            
            <div class="form-group">
                <label style="color:#059669;">è«‹é¸æ“‡è¨ˆç®—æ¨¡å¼</label>
                <div class="input-group" style="border: 2px solid #10b981;">
                    <select id="calc_type" onchange="toggleInputs()">
                        <option value="sip">å®šæœŸå®šé¡æŠ•è³‡ (æ¯æœˆå­˜)</option>
                        <option value="lump">å–®ç­†æŠ•å…¥æŠ•è³‡ (åˆ©æ»¾åˆ©)</option>
                        <option value="cash">æŒæœ‰ç¾é‡‘/å›ºå®šé‡‘é¡ (ä¸æŠ•è³‡)</option>
                    </select>
                </div>
            </div>

            <div class="form-group" id="group_monthly">
                <label>æ¯æœˆæŠ•å…¥é‡‘é¡</label>
                <div class="input-group">
                    <input type="number" id="inp_monthly" value="10000" oninput="calculate()">
                    <span class="unit">å…ƒ</span>
                </div>
            </div>

            <div class="form-group hidden" id="group_initial">
                <label>èµ·å§‹æœ¬é‡‘ (å–®ç­†)</label>
                <div class="input-group">
                    <input type="number" id="inp_initial" value="2000000" oninput="calculate()">
                    <span class="unit">å…ƒ</span>
                </div>
            </div>

            <div class="form-group" id="group_rate">
                <label>é æœŸå¹´åŒ–å ±é…¬ç‡</label>
                <div class="input-group">
                    <input type="number" id="inp_rate" value="6" step="0.1" oninput="calculate()">
                    <span class="unit">%</span>
                </div>
            </div>

            <div class="form-group">
                <label>è¨ˆç®—æœŸé–“ (å¹´)</label>
                <div class="input-group">
                    <input type="number" id="inp_years" value="20" min="1" max="100" oninput="calculate()">
                    <span class="unit">å¹´</span>
                </div>
            </div>
        </div>

        <div class="panel panel-inflation">
            <h2>ğŸ”¥ é€šè†¨è¨­å®š (è³¼è²·åŠ›ç¸®æ°´)</h2>
            <div class="form-group">
                <label>é ä¼°å¹³å‡é€šè†¨ç‡</label>
                <div class="input-group">
                    <input type="number" id="inf_rate" value="2.5" step="0.1" oninput="calculate()">
                    <span class="unit">%</span>
                </div>
            </div>
            
            <div style="background: rgba(255,255,255,0.6); padding: 15px; border-radius: 8px; margin-top: 20px;">
                <label style="font-size:0.9rem; color:#b91c1c;">ç¾åœ¨ 100 å…ƒçš„è³¼è²·åŠ›ï¼Œåœ¨ <span id="preview_years">20</span> å¹´å¾Œ...</label>
                <div style="font-size: 1.1rem; font-weight:bold; color:#b91c1c; margin-top:5px;">
                    éœ€è¦èŠ± <span id="preview_cost" style="font-size:1.6rem;">164</span> å…ƒæ‰èƒ½è²·åˆ°
                </div>
            </div>
             <p style="font-size:0.85rem; color:#666; margin-top:10px;">
                * å³ä¾¿ä¸æŠ•è³‡ï¼Œæ‚¨çš„éŒ¢ä¹Ÿæœƒå› ç‚ºé€šè†¨è€Œè‡ªå‹•è®Šè–„ã€‚
            </p>
        </div>
    </div>

    <div class="bottom-section">
        <div class="summary-cards">
            <div class="card">
                <h3>æœŸæ»¿å¸³é¢é‡‘é¡ (åç›®)</h3>
                <div class="value val-nominal" id="res_nominal">0</div>
                <div class="sub-text">å­˜æ‘ºä¸Šçš„æ•¸å­—</div>
            </div>
            <div class="card" style="border-color: var(--real-color); background-color:#eff6ff;">
                <h3>å¯¦è³ªè³¼è²·åŠ› (æŠ˜ç¾)</h3>
                <div class="value val-real" id="res_real">0</div>
                <div class="sub-text">ç­‰æ–¼ç¾åœ¨çš„åƒ¹å€¼</div>
            </div>
            <div class="card" style="border-color: var(--inf-color); background-color:#fff1f2;">
                <h3>è¢«é€šè†¨åƒæ‰çš„åƒ¹å€¼</h3>
                <div class="value val-loss" id="res_loss">0</div>
                <div class="sub-text">ç¸®æ°´å¹…åº¦ <span id="res_loss_pct">0%</span></div>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="mainChart"></canvas>
        </div>

        <div class="table-wrapper">
            <table id="resultTable">
                <thead>
                    <tr>
                        <th>å¹´åº¦</th>
                        <th>å¸³é¢é‡‘é¡ (åç›®)</th>
                        <th>ç‰©åƒ¹æŒ‡æ•¸ (åŸºæœŸ100)</th>
                        <th>å¯¦è³ªè³¼è²·åŠ› (çœŸéŒ¢)</th>
                        <th>ç¸®æ°´é‡‘é¡</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    let myChart = null;

    window.onload = function() {
        toggleInputs(); // åˆå§‹åŒ–æ¬„ä½é¡¯ç¤º
        calculate();
    }

    // åˆ‡æ›è¼¸å…¥æ¬„ä½é¡¯ç¤ºé‚è¼¯
    function toggleInputs() {
        const type = document.getElementById('calc_type').value;
        const groupMonthly = document.getElementById('group_monthly');
        const groupInitial = document.getElementById('group_initial');
        const groupRate = document.getElementById('group_rate');

        if (type === 'sip') {
            // å®šæœŸå®šé¡
            groupMonthly.classList.remove('hidden');
            groupInitial.classList.add('hidden');
            groupRate.classList.remove('hidden');
        } else if (type === 'lump') {
            // å–®ç­†æŠ•è³‡
            groupMonthly.classList.add('hidden');
            groupInitial.classList.remove('hidden');
            groupRate.classList.remove('hidden');
        } else {
            // æŒæœ‰ç¾é‡‘ (å›ºå®šé‡‘é¡)
            groupMonthly.classList.add('hidden');
            groupInitial.classList.remove('hidden');
            groupRate.classList.add('hidden'); // æ—¢ç„¶æ˜¯ç¾é‡‘æ­»éŒ¢ï¼Œå°±ä¸é¡¯ç¤ºå ±é…¬ç‡(è¦–ç‚º0)
        }
        calculate();
    }

    function calculate() {
        // 1. å–å¾—å…±ç”¨è¼¸å…¥
        const type = document.getElementById('calc_type').value;
        const years = parseInt(document.getElementById('inp_years').value) || 0;
        const infRate = parseFloat(document.getElementById('inf_rate').value) / 100 || 0;

        // æ›´æ–°é€šè†¨é è¦½
        document.getElementById('preview_years').innerText = years;
        const bentoCost = Math.round(100 * Math.pow(1 + infRate, years));
        document.getElementById('preview_cost').innerText = bentoCost;

        if (years <= 0) return;

        // 2. æº–å‚™è®Šæ•¸
        let labels = [];
        let nominalData = [];
        let realData = [];
        let tableHTML = "";

        // æ ¹æ“šæ¨¡å¼å–å¾—ç‰¹å®šè¼¸å…¥
        let monthlyAmt = 0;
        let initialAmt = 0;
        let invRate = 0;
        let monthlyInvRate = 0;

        if (type === 'sip') {
            monthlyAmt = parseFloat(document.getElementById('inp_monthly').value) || 0;
            invRate = parseFloat(document.getElementById('inp_rate').value) / 100 || 0;
            monthlyInvRate = invRate / 12;
        } else if (type === 'lump') {
            initialAmt = parseFloat(document.getElementById('inp_initial').value) || 0;
            invRate = parseFloat(document.getElementById('inp_rate').value) / 100 || 0;
        } else {
            // cash
            initialAmt = parseFloat(document.getElementById('inp_initial').value) || 0;
            invRate = 0; // ç¾é‡‘è¦–ç‚º 0% å ±é…¬
        }

        // 3. è¨ˆç®—æ ¸å¿ƒ
        let nominalBalance = (type === 'sip') ? 0 : initialAmt;

        for (let y = 1; y <= years; y++) {
            
            // è¨ˆç®—è©²å¹´åº•çš„å¸³é¢é‡‘é¡
            if (type === 'sip') {
                // è·‘12å€‹æœˆè¤‡åˆ©
                for (let m = 0; m < 12; m++) {
                    nominalBalance = (nominalBalance + monthlyAmt) * (1 + monthlyInvRate);
                }
            } else if (type === 'lump') {
                // å–®ç­†è¤‡åˆ©å…¬å¼
                nominalBalance = nominalBalance * (1 + invRate);
            } else {
                // ç¾é‡‘ï¼šé‡‘é¡ä¸è®Š
                nominalBalance = initialAmt; 
            }

            // è¨ˆç®—å¯¦è³ªè³¼è²·åŠ› (æŠ˜ç¾)
            let discountFactor = Math.pow(1 + infRate, y);
            let realPurchasingPower = nominalBalance / discountFactor;
            let loss = nominalBalance - realPurchasingPower;

            // ç´€éŒ„
            labels.push(`ç¬¬ ${y} å¹´`);
            nominalData.push(nominalBalance);
            realData.push(realPurchasingPower);

            tableHTML += `
                <tr>
                    <td>ç¬¬ ${y} å¹´</td>
                    <td class="val-nominal">${formatCurrency(nominalBalance)}</td>
                    <td>${(discountFactor * 100).toFixed(1)}</td>
                    <td class="val-real" style="font-weight:bold;">${formatCurrency(realPurchasingPower)}</td>
                    <td class="val-loss">-${formatCurrency(loss)}</td>
                </tr>
            `;
        }

        // 4. æ›´æ–°UI
        const finalNominal = nominalData[nominalData.length - 1];
        const finalReal = realData[realData.length - 1];
        const finalLoss = finalNominal - finalReal;
        
        // é¿å…é™¤ä»¥0
        let lossPct = 0;
        if(finalNominal > 0) {
            lossPct = (finalLoss / finalNominal * 100).toFixed(1);
        }

        animateValue("res_nominal", finalNominal);
        animateValue("res_real", finalReal);
        animateValue("res_loss", finalLoss);
        document.getElementById("res_loss_pct").innerText = lossPct + "%";
        document.querySelector("#resultTable tbody").innerHTML = tableHTML;

        // 5. æ›´æ–°åœ–è¡¨
        updateChart(labels, nominalData, realData, type);
    }

    function updateChart(labels, nominalData, realData, type) {
        const ctx = document.getElementById('mainChart').getContext('2d');

        if (myChart) {
            myChart.destroy();
        }

        let chartTitle = 'è³‡ç”¢å¢é•· vs å¯¦è³ªè³¼è²·åŠ›';
        if (type === 'cash') chartTitle = 'æŒæœ‰ç¾é‡‘ï¼šå¸³é¢ä¸è®Š vs è³¼è²·åŠ›ä¸‹é™';

        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'å¸³é¢é‡‘é¡ (åç›®)',
                        data: nominalData,
                        borderColor: '#10b981', 
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        pointRadius: 0,
                        fill: false
                    },
                    {
                        label: 'å¯¦è³ªè³¼è²·åŠ› (çœŸéŒ¢)',
                        data: realData,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.4)', // è—è‰²å¡«å……
                        borderWidth: 3,
                        pointRadius: 0,
                        fill: true // å¡«å……ä¸‹æ–¹å€åŸŸ
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                plugins: {
                    title: {
                        display: true,
                        text: chartTitle,
                        font: { size: 16 }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + formatCurrency(context.raw);
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: {
                            callback: function(value) {
                                if(value >= 10000) return '$' + Math.round(value/10000) + 'è¬';
                                return '$' + value;
                            }
                        }
                    }
                }
            }
        });
    }

    function animateValue(id, end) {
        document.getElementById(id).innerHTML = formatCurrency(end);
    }

    function formatCurrency(num) {
        return new Intl.NumberFormat('zh-TW', { 
            style: 'currency', 
            currency: 'TWD', 
            minimumFractionDigits: 0 
        }).format(Math.round(num));
    }
</script>

</body>
</html>